# CORS - Support de plusieurs origines
SetEnvIf Origin "^(https?://localhost:5173|https://[\w-]+\.onrender\.com|https://www\.mh-logiciel\.fr)$" ORIGIN_ALLOWED=$0

Header always unset Access-Control-Allow-Origin
Header always set Access-Control-Allow-Origin "%{ORIGIN_ALLOWED}e" env=ORIGIN_ALLOWED
Header always set Access-Control-Allow-Methods "GET, POST, OPTIONS, PUT, DELETE, PATCH"
Header always set Access-Control-Allow-Headers "Content-Type, Authorization, Accept, Origin"
Header always set Access-Control-Allow-Credentials "true"
Header always set Access-Control-Max-Age "3600"
Header always set Vary "Origin"

# Transmettre le header Authorization à PHP
RewriteEngine On
RewriteCond %{HTTP:Authorization} .+
RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]

# Gestion des requêtes OPTIONS (preflight)
RewriteCond %{REQUEST_METHOD} OPTIONS
RewriteRule ^(.*)$ - [R=200,L]

# Redirection vers index.php
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ index.php [QSA,L]